#include "hight_config.h"

#ifndef _HIGHT_H
#define _HIGHT_H

static const u8 delta_table[128] = {
    0x5aU, 0x6dU, 0x36U, 0x1bU, 0x0dU, 0x06U, 0x03U, 0x41U, // 0 ~ 7
    0x60U, 0x30U, 0x18U, 0x4cU, 0x66U, 0x33U, 0x59U, 0x2cU, // 8 ~ 15
    0x56U, 0x2bU, 0x15U, 0x4aU, 0x65U, 0x72U, 0x39U, 0x1cU, // 16 ~ 23 
    0x4eU, 0x67U, 0x73U, 0x79U, 0x3cU, 0x5eU, 0x6fU, 0x37U, // 24 ~ 31 
    0x5bU, 0x2dU, 0x16U, 0x0bU, 0x05U, 0x42U, 0x21U, 0x50U, // 32 ~ 39 
    0x28U, 0x54U, 0x2aU, 0x55U, 0x6aU, 0x75U, 0x7aU, 0x7dU, // 40 ~ 47 
    0x3eU, 0x5fU, 0x2fU, 0x17U, 0x4bU, 0x25U, 0x52U, 0x29U, // 48 ~ 55 
    0x14U, 0x0aU, 0x45U, 0x62U, 0x31U, 0x58U, 0x6cU, 0x76U, // 56 ~ 63 
    0x3bU, 0x1dU, 0x0eU, 0x47U, 0x63U, 0x71U, 0x78U, 0x7cU, // 64 ~ 71 
    0x7eU, 0x7fU, 0x3fU, 0x1fU, 0x0fU, 0x07U, 0x43U, 0x61U, // 72 ~ 79 
    0x70U, 0x38U, 0x5cU, 0x6eU, 0x77U, 0x7bU, 0x3dU, 0x1eU, // 80 ~ 87 
    0x4fU, 0x27U, 0x53U, 0x69U, 0x34U, 0x1aU, 0x4dU, 0x26U, // 88 ~ 95 
    0x13U, 0x49U, 0x24U, 0x12U, 0x09U, 0x04U, 0x02U, 0x01U, // 96 ~ 103 
    0x40U, 0x20U, 0x10U, 0x08U, 0x44U, 0x22U, 0x11U, 0x48U, // 104 ~ 111 
    0x64U, 0x32U, 0x19U, 0x0cU, 0x46U, 0x23U, 0x51U, 0x68U, // 112 ~ 119 
    0x74U, 0x3aU, 0x5dU, 0x2eU, 0x57U, 0x6bU, 0x35U, 0x5aU  // 120 ~ 127
};

void encKeySchedule(u8 enc_WK[8], 
                    u8 enc_SK[128],
                    const u8 MK[16]);

void decKeySchedule(u8 dec_WK[8], u8 dec_SK[128], const u8 MK[16]);

// static inline u8 ROTL(u8 byte, u8 shift) {
//     return (byte << shift) | (byte >> (8 - shift));
// }

static inline u8 F0(u8 byte) {
    // ROTL(byte, 1) ^ ROTL(byte, 2) ^ ROTL(byte, 7);
    return ((byte << 1) | (byte >> 7)) ^
           ((byte << 2) | (byte >> 6)) ^
           ((byte << 7) | (byte >> 1));
}

static inline u8 F1(u8 byte) {
    // return ROTL(byte, 3) ^ ROTL(byte, 4) ^ ROTL(byte, 6);
    return ((byte << 3) | (byte >> 5)) ^
           ((byte << 4) | (byte >> 4)) ^
           ((byte << 6) | (byte >> 2));
}

void HIGHT_Encrypt(u8 dst[8], const u8 src[8], const u8 MK[16]);
void HIGHT_Decrypt(u8 dst[8], const u8 src[8], const u8 MK[16]);

#endif /* _HIGHT_H */